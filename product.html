<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haider Mobiles | Terminal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        :root { --gold: #d4af37; --bg: #000; --card: #0f0f0f; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: #fff; margin: 0; padding-top: 60px; }
        .container { max-width: 1100px; margin: 0 auto; padding: 0 20px; }
        
        /* Premium Layout */
        .product-grid-main { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 40px; margin-top: 30px; }
        .gallery-section { text-align: center; }
        .main-img-box { height: 450px; background: #fff; border-radius: 20px; display: flex; align-items: center; justify-content: center; overflow: hidden; border: 1px solid #222; }
        .main-img-box img { max-width: 90%; max-height: 90%; object-fit: contain; }
        
        .thumbs { display: flex; gap: 10px; margin-top: 15px; justify-content: center; }
        .thumbs img { width: 70px; height: 70px; border: 2px solid transparent; border-radius: 10px; cursor: pointer; background: #fff; padding: 5px; object-fit: contain; }
        .thumbs img.active { border-color: var(--gold); }

        .price-tag { font-size: 32px; font-weight: 800; color: var(--gold); margin: 20px 0; }
        .desc-box { background: var(--card); border: 1px solid #222; padding: 20px; border-radius: 15px; line-height: 1.6; color: #aaa; }
        
        .wa-buy { background: #0066cc; color: white; text-decoration: none; display: block; padding: 18px; text-align: center; border-radius: 12px; font-weight: bold; margin-top: 20px; font-size: 18px; }
        
        /* Related Products */
        .related-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; margin: 40px 0; }
        .rel-card { background: var(--card); padding: 15px; border-radius: 15px; border: 1px solid #222; text-decoration: none; color: #fff; text-align: center; }
        .rel-card img { width: 100%; height: 120px; object-fit: contain; background: #fff; border-radius: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div id="product-content">
        <p style="text-align:center; padding: 50px;">Accessing Database...</p>
    </div>

    <h3 style="margin-top:60px; color:var(--gold); border-bottom: 1px solid #222; padding-bottom: 10px;">RELATED_STOCK</h3>
    <div id="related-grid" class="related-grid"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCYzkMGDwWZGx_PlrNfjloYZ6PVQRne9wg",
        authDomain: "web-app-4f3a1.firebaseapp.com",
        projectId: "web-app-4f3a1",
        databaseURL: "https://web-app-4f3a1-default-rtdb.firebaseio.com",
        appId: "1:222099203820:web:778e204d2960181dfba7c9"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const pId = new URLSearchParams(window.location.search).get('id');

    if (pId) {
        onValue(ref(db, 'products/' + pId), (snap) => {
            const p = snap.val();
            if(!p) return;

            const imgs = [p.img, p.img2, p.img3].filter(x => x);
            document.getElementById('product-content').innerHTML = `
                <div class="product-grid-main">
                    <div class="gallery-section">
                        <div class="main-img-box"><img id="mImg" src="${imgs[0]}"></div>
                        <div class="thumbs">
                            ${imgs.map(i => `<img src="${i}" onclick="document.getElementById('mImg').src='${i}'">`).join('')}
                        </div>
                    </div>
                    <div class="info-section">
                        <span style="color:var(--gold); font-size:12px; letter-spacing:2px;">${p.brand}</span>
                        <h1 style="margin:10px 0;">${p.name}</h1>
                        <div class="price-tag">${p.price}</div>
                        <div class="desc-box">${p.description || 'No additional specs provided.'}</div>
                        <a href="https://wa.me/923279518790?text=I want to buy: ${p.name}" class="wa-buy">
                            <i class="fab fa-whatsapp"></i> ORDER ON WHATSAPP
                        </a>
                    </div>
                </div>
            `;
            loadRelated(p.category, pId);
        });
    }

    function loadRelated(cat, currentId) {
        get(ref(db, 'products')).then(snap => {
            const grid = document.getElementById('related-grid');
            grid.innerHTML = "";
            snap.forEach(child => {
                const prod = child.val();
                if(child.key !== currentId && prod.category === cat) {
                    grid.innerHTML += `
                        <a href="product.html?id=${child.key}" class="rel-card">
                            <img src="${prod.img}">
                            <h4 style="font-size:14px; margin:10px 0 5px;">${prod.name}</h4>
                            <div style="color:var(--gold); font-weight:bold;">${prod.price}</div>
                        </a>`;
                }
            });
        });
    }
</script>
</body>
</html>
