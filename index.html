<div class="top-header">
    <a href="index.html" class="store-name">HAIDER MOBILES</a>
    <i class="fa fa-search" style="color:var(--gold)"></i>
</div>

<div class="brand-nav">
    <div class="brand-chip active" onclick="filterData('All', this)">All</div>
    <div class="brand-chip" onclick="filterData('Accessory', this, true)">Accessories</div>
    <div class="brand-chip" onclick="sortPrice()">Price: Low to High</div>
</div>

<div id="chip-container" class="brand-nav"></div>

<div id="product-grid" class="product-grid">
    <p style="text-align:center; width:100%; grid-column: 1/-1;">Connecting...</p>
</div>

<script type="module">
    // ... (Firebase Initialize wala part wahi rahega) ...
    
    let localProducts = []; // Data save karne ke liye

    onValue(ref(db, 'products'), (snapshot) => {
        if (!snapshot.exists()) return;
        const data = snapshot.val();
        localProducts = Object.keys(data).map(key => ({ id: key, ...data[key] }));
        
        // Brands generate karein (Pehele ki tarah)
        const brands = [...new Set(localProducts.map(p => p.brand).filter(b => b && b !== 'undefined'))];
        renderBrandChips(brands);
        
        display(localProducts);
    });

    // ✨ NAYA: Filter Function
    window.filterData = function(val, el, isCat = false) {
        document.querySelectorAll('.brand-chip').forEach(c => c.classList.remove('active'));
        el.classList.add('active');
        
        let filtered;
        if(val === 'All') filtered = localProducts;
        else if(isCat) filtered = localProducts.filter(p => p.category === 'Accessory');
        else filtered = localProducts.filter(p => p.brand === val);
        
        display(filtered);
    }

    // ✨ NAYA: Sort Function
    window.sortPrice = function() {
        let sorted = [...localProducts].sort((a, b) => {
            let p1 = parseInt(a.price.toString().replace(/\D/g,'')) || 0;
            let p2 = parseInt(b.price.toString().replace(/\D/g,'')) || 0;
            return p1 - p2;
        });
        display(sorted);
    }

    function renderBrandChips(brands) {
        // Aapka purana brand chip rendering logic yahan aayega
        // Bas onclick par filterData(brand, this) call karna hai
    }

    function display(items) {
        grid.innerHTML = "";
        items.forEach(p => {
            grid.innerHTML += `
                <div class="card">
                    <img src="${p.img || ''}">
                    <h3>${p.name}</h3>
                    <span class="price">Rs. ${p.price}</span>
                    <a href="product.html?id=${p.id}" class="btn-view">VIEW DETAILS</a>
                </div>`;
        });
    }
</script>
