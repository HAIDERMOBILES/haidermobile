<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jarvis Admin | Haider Mobiles</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@300;400;600&display=swap');
        :root { --gold: #d4af37; --bg: #050505; --card: #0d0d0d; --border: #1a1a1a; --neon: rgba(212, 175, 55, 0.4); }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: #fff; margin: 0; padding: 20px; overflow-x: hidden; }
        .jarvis-container { max-width: 1200px; margin: auto; }
        .jarvis-header { text-align: center; margin-bottom: 40px; }
        .jarvis-header h2 { font-family: 'Orbitron', sans-serif; color: var(--gold); letter-spacing: 5px; text-shadow: 0 0 15px var(--neon); }
        .main-layout { display: grid; grid-template-columns: 380px 1fr; gap: 30px; }
        .upload-card { background: rgba(15, 15, 15, 0.8); backdrop-filter: blur(10px); border: 1px solid var(--border); padding: 25px; border-radius: 24px; position: sticky; top: 20px; }
        .upload-area { border: 1px dashed #333; padding: 15px; text-align: center; border-radius: 15px; cursor: pointer; margin-bottom: 15px; background: rgba(0,0,0,0.3); }
        input, select, textarea { width: 100%; padding: 12px; margin-bottom: 12px; background: #000; border: 1px solid #222; color: #fff; border-radius: 10px; font-size: 13px; }
        .progress-bar { height: 3px; width: 0%; background: var(--gold); transition: 0.3s; margin-top: 5px; }
        .inv-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(170px, 1fr)); gap: 20px; }
        .inv-card { background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 15px; text-align: center; position: relative; }
        .inv-card img { width: 100%; height: 100px; object-fit: contain; background: #fff; border-radius: 10px; }
        .del-btn { position: absolute; top: 10px; right: 10px; background: #ff4757; border: none; color: #fff; width: 25px; height: 25px; border-radius: 50%; cursor: pointer; }
        .save-btn { width: 100%; padding: 15px; background: var(--gold); border: none; border-radius: 12px; font-weight: 700; cursor: pointer; font-family: 'Orbitron'; }
        
        /* üõ°Ô∏è Login Overlay */
        #loginOverlay { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; align-items: center; justify-content: center; }
        #loginBox { text-align: center; background: #0d0d0d; padding: 40px; border-radius: 20px; border: 1px solid var(--gold); }
    </style>
</head>
<body>

<div id="loginOverlay">
    <div id="loginBox">
        <h2 style="font-family:'Orbitron'; color:var(--gold)">ACCESS REQUIRED</h2>
        <input type="password" id="passInput" placeholder="Enter System Key">
        <button onclick="checkPass()" class="save-btn">AUTHORIZE</button>
    </div>
</div>

<div class="jarvis-container">
    <div class="jarvis-header">
        <h2>JARVIS TERMINAL V2.1</h2>
        <p style="letter-spacing: 2px; font-size: 10px; color: #555;">SECURE INVENTORY UPLINK</p>
    </div>

    <div class="main-layout">
        <div class="upload-card">
            <div class="upload-area" onclick="document.getElementById('f1').click()">
                <small id="t1"><i class="fa fa-image"></i> MAIN FRAME</small>
                <input type="file" id="f1" hidden onchange="uploadImg(this, 'img1', 't1', 'p1')">
                <div class="progress-bar" id="p1"></div>
            </div>
            <input type="text" id="pName" placeholder="Unit Name (e.g. iPhone 15)">
            <input type="text" id="pBrand" placeholder="Manufacturer (e.g. Apple)">
            <input type="number" id="pPrice" placeholder="Credits (Price)">
            <select id="pCat">
                <option value="Mobile">Mobile Unit</option>
                <option value="Accessories">Accessory Gear</option>
            </select>
            <textarea id="pDesc" placeholder="Technical Specs..." rows="2"></textarea>
            <button id="saveBtn" class="save-btn">EXECUTE UPLOAD</button>
        </div>

        <div class="inventory-display">
            <h3 style="font-family:'Orbitron'; font-size:14px; margin-bottom:20px;"><i class="fa fa-database"></i> ACTIVE DATABASE</h3>
            <div id="invGrid" class="inv-grid"></div>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCYzkMGDwWZGx_PlrNfjloYZ6PVQRne9wg",
        authDomain: "web-app-4f3a1.firebaseapp.com",
        projectId: "web-app-4f3a1",
        databaseURL: "https://web-app-4f3a1-default-rtdb.firebaseio.com",
        appId: "1:222099203820:web:778e204d2960181dfba7c9"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const IMGBB_KEY = "6d9d7a90a22cdb8a25ed839df7365b8c";
    let urls = { img1: "" };

    // Password Check
    window.checkPass = () => {
        const pass = document.getElementById('passInput').value;
        if(pass === "haider786") { // <--- Apna password yahan set karein
            document.getElementById('loginOverlay').style.display = 'none';
        } else {
            alert("ACCESS DENIED");
        }
    };

    // Upload Image Logic
    window.uploadImg = async (input, key, txtId, progId) => {
        const file = input.files[0]; if(!file) return;
        const text = document.getElementById(txtId);
        const bar = document.getElementById(progId);
        text.innerText = "Transmitting..."; bar.style.width = "50%";

        const fd = new FormData(); fd.append("image", file);
        try {
            const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`, { method: "POST", body: fd });
            const data = await res.json();
            if(data.success) {
                urls[key] = data.data.url;
                bar.style.width = "100%";
                text.innerText = "LINKED"; text.style.color = "var(--gold)";
            }
        } catch (e) { text.innerText = "FAILED"; }
    };

    // Load Database
    onValue(ref(db, 'products'), (snap) => {
        const grid = document.getElementById('invGrid');
        grid.innerHTML = "";
        if (snap.exists()) {
            const list = Object.keys(snap.val()).map(id => ({ id, ...snap.val()[id] })).reverse();
            grid.innerHTML = list.map(p => `
                <div class="inv-card">
                    <button class="del-btn" onclick="window.deleteItem('${p.id}')"><i class="fa fa-trash"></i></button>
                    <img src="${p.img}" onerror="this.src='faq/Gemini.png'">
                    <h4 style="font-size:12px; margin:10px 0;">${p.name}</h4>
                    <b style="color:var(--gold)">Rs ${new Intl.NumberFormat('en-PK').format(p.price)}</b>
                </div>
            `).join('');
        }
    });

    // Delete Logic (Fixed Global Scope)
    window.deleteItem = (id) => {
        if(confirm("Confirm Deletion?")) remove(ref(db, `products/${id}`));
    };

    // Save Logic
    document.getElementById('saveBtn').onclick = function() {
        const name = document.getElementById('pName').value;
        const price = document.getElementById('pPrice').value;
        if(!urls.img1 || !name || !price) return alert("Fill mandatory fields, Sir.");

        this.disabled = true; this.innerText = "SYNCING...";
        const product = {
            name: name,
            brand: document.getElementById('pBrand').value,
            price: Number(price), // ‚úÖ Fixed: Save as Number
            category: document.getElementById('pCat').value,
            description: document.getElementById('pDesc').value,
            img: urls.img1,
            timestamp: Date.now()
        };

        push(ref(db, 'products'), product).then(() => {
            alert("DATABASE UPDATED");
            location.reload();
        });
    };
</script>
</body>
</html>
