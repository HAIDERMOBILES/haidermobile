<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haider Mobiles | Central Control</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #d4af37; --bg: #050505; --card: #111; --border: #222; --green: #25d366; }
        body { background: var(--bg); color: #fff; font-family: 'Inter', sans-serif; margin: 0; padding: 20px; }
        .admin-container { max-width: 1200px; margin: 0 auto; }
        
        /* ‚ú® Header */
        .header-box { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 1px solid var(--border); padding-bottom: 15px; }
        .logo-text { font-family: 'Orbitron'; color: var(--gold); letter-spacing: 2px; }

        /* üöÄ NEW: Product Upload Form Style */
        .upload-section { background: rgba(212, 175, 55, 0.05); padding: 25px; border-radius: 15px; border: 1px dashed var(--gold); margin-bottom: 40px; }
        .upload-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        
        /* üìä Stats Grid */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .stat-card { background: var(--card); padding: 15px; border-radius: 12px; border: 1px solid var(--border); text-align: center; }
        .stat-card p { font-size: 22px; font-weight: 800; color: var(--gold); margin: 5px 0 0; }

        /* üîç Inputs & Tables */
        .input-field { width: 100%; padding: 12px; background: #000; border: 1px solid var(--border); border-radius: 8px; color: #fff; outline: none; margin-bottom: 10px; }
        .input-field:focus { border-color: var(--gold); }
        
        .table-wrap { background: var(--card); border-radius: 15px; overflow-x: auto; border: 1px solid var(--border); }
        table { width: 100%; border-collapse: collapse; min-width: 900px; }
        th { background: #1a1a1a; color: var(--gold); padding: 15px; text-align: left; font-size: 12px; font-family: 'Orbitron'; }
        td { padding: 15px; border-bottom: 1px solid #1a1a1a; font-size: 13px; }
        
        /* üü¢ Status & Buttons */
        .status-select { background: #000; color: #fff; border: 1px solid #444; border-radius: 5px; padding: 5px; font-size: 11px; }
        .btn { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 12px; border: none; transition: 0.3s; }
        .btn-gold { background: var(--gold); color: #000; width: 100%; font-family: 'Orbitron'; }
        .btn-gold:hover { background: #b8962d; transform: scale(1.02); }
        .btn-del { background: #333; color: #ff4757; padding: 6px 12px; }
        .btn-wa { background: var(--green); color: #fff; text-decoration: none; padding: 6px 12px; border-radius: 6px; font-size: 11px; }
        
        .order-item { background: #000; padding: 8px; border-radius: 5px; margin-bottom: 5px; border-left: 3px solid var(--gold); font-size: 12px; }
    </style>
</head>
<body>

<div class="admin-container">
    <div class="header-box">
        <h2 class="logo-text"><i class="fa fa-shuttle-space"></i> CENTRAL_COMMAND</h2>
        <div style="display:flex; gap:10px;">
            <button class="btn" style="background:#222; color:#fff" onclick="location.reload()">Refresh System</button>
            <a href="index.html" target="_blank" class="btn btn-gold" style="width:auto">View Website</a>
        </div>
    </div>

    <div class="upload-section">
        <h3 style="color:var(--gold); font-family:'Orbitron'; font-size:14px; margin-bottom:20px;"><i class="fa fa-plus-circle"></i> UPLOAD NEW GEAR TO WEBSITE</h3>
        <div class="upload-grid">
            <input type="text" id="pName" placeholder="Product Name (e.g. iPhone 13 Pro)" class="input-field">
            <input type="number" id="pPrice" placeholder="Price (Rs)" class="input-field">
            <select id="pCat" class="input-field">
                <option value="Mobile">Mobile Phones</option>
                <option value="Accessories">Accessories</option>
                <option value="Repairing">Repairing Services</option>
                <option value="Tools">Repairing Tools</option>
            </select>
            <input type="text" id="pBrand" placeholder="Brand (e.g. Samsung, Apple)" class="input-field">
            <input type="text" id="pImg" placeholder="Direct Image URL" class="input-field">
        </div>
        <button onclick="window.uploadProduct()" class="btn btn-gold" style="margin-top:15px;">DEPLOY TO FRONTEND</button>
    </div>

    <div class="stats-grid">
        <div class="stat-card"><h4>Users</h4><p id="totalUsers">0</p></div>
        <div class="stat-card"><h4>Total Orders</h4><p id="totalOrders">0</p></div>
        <div class="stat-card"><h4>Pending</h4><p id="pendingOrders" style="color:#ff4757;">0</p></div>
    </div>

    <input type="text" id="adminSearch" class="input-field" placeholder="Search orders by customer name, phone or CNIC...">

    <div class="table-wrap">
        <table>
            <thead>
                <tr>
                    <th>Customer Details</th>
                    <th>Contact & CNIC</th>
                    <th>Orders & Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="adminTable"></tbody>
        </table>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue, update, remove, push, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCYzkMGDwWZGx_PlrNfjloYZ6PVQRne9wg",
        authDomain: "web-app-4f3a1.firebaseapp.com",
        projectId: "web-app-4f3a1",
        databaseURL: "https://web-app-4f3a1-default-rtdb.firebaseio.com",
        appId: "1:222099203820:web:778e204d2960181dfba7c9"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // --- üöÄ NEW: PRODUCT UPLOAD LOGIC ---
    window.uploadProduct = () => {
        const name = document.getElementById('pName').value;
        const price = document.getElementById('pPrice').value;
        const cat = document.getElementById('pCat').value;
        const brand = document.getElementById('pBrand').value;
        const img = document.getElementById('pImg').value;

        if(!name || !price || !img) {
            alert("Sir, please fill Name, Price and Image URL!");
            return;
        }

        const newProductRef = push(ref(db, 'products'));
        set(newProductRef, {
            name,
            price: parseInt(price),
            category: cat,
            brand,
            img
        }).then(() => {
            alert("System Success: Product is now live on the website!");
            document.getElementById('pName').value = "";
            document.getElementById('pPrice').value = "";
            document.getElementById('pImg').value = "";
        });
    };

    // --- üîÑ ORDER MANAGEMENT LOGIC ---
    onValue(ref(db, 'users'), (snapshot) => {
        const adminTable = document.getElementById('adminTable');
        adminTable.innerHTML = "";
        let uCount = 0, oCount = 0, pCount = 0;

        snapshot.forEach((child) => {
            uCount++;
            const uid = child.key;
            const user = child.val();
            const orders = user.orders || {};

            let orderHtml = "";
            Object.keys(orders).forEach(oid => {
                oCount++;
                const order = orders[oid];
                if(order.status === "Pending") pCount++;
                
                orderHtml += `
                    <div class="order-item">
                        <b>${order.items || 'Items'}</b><br>
                        <small style="color:#555">${order.date || ''}</small><br>
                        <select class="status-select" onchange="window.updateStatus('${uid}', '${oid}', this)">
                            <option value="Pending" ${order.status==='Pending'?'selected':''}>Pending</option>
                            <option value="Shipped" ${order.status==='Shipped'?'selected':''}>Shipped</option>
                            <option value="Delivered" ${order.status==='Delivered'?'selected':''}>Delivered</option>
                        </select>
                    </div>`;
            });

            adminTable.innerHTML += `
                <tr class="user-row">
                    <td><b>${user.name || 'Unknown'}</b><br><small style="color:#888">${user.email || ''}</small></td>
                    <td>${user.phone || 'N/A'}<br><small style="color:#555">CNIC: ${user.cnic || 'N/A'}</small></td>
                    <td>${orderHtml || '<span style="color:#333">No Orders</span>'}</td>
                    <td>
                        <button class="btn btn-del" onclick="window.deleteUser('${uid}')"><i class="fa fa-trash"></i></button>
                        <a href="https://wa.me/${user.phone}" class="btn btn-wa" target="_blank"><i class="fab fa-whatsapp"></i></a>
                    </td>
                </tr>`;
        });

        document.getElementById('totalUsers').innerText = uCount;
        document.getElementById('totalOrders').innerText = oCount;
        document.getElementById('pendingOrders').innerText = pCount;
    });

    window.updateStatus = (uid, oid, elem) => {
        update(ref(db, `users/${uid}/orders/${oid}`), { status: elem.value })
        .then(() => alert("Database Synchronized: Status Updated!"));
    };

    window.deleteUser = (uid) => {
        if(confirm("Confirm Deletion? All user data will be lost.")) {
            remove(ref(db, `users/${uid}`));
        }
    };

    document.getElementById('adminSearch').oninput = (e) => {
        const val = e.target.value.toLowerCase();
        document.querySelectorAll('.user-row').forEach(row => {
            row.style.display = row.innerText.toLowerCase().includes(val) ? '' : 'none';
        });
    };
</script>
</body>
</html>
