<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haider Mobiles | Order Central</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        :root { --gold: #d4af37; --bg: #050505; --card: #111; --border: #222; }
        body { background: var(--bg); color: #fff; font-family: 'Inter', sans-serif; margin: 0; padding: 20px; }
        .admin-container { max-width: 1100px; margin: 0 auto; }
        
        /* ‚ú® Header & Stats */
        .header-box { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 1px solid var(--border); padding-bottom: 15px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .stat-card { background: var(--card); padding: 15px; border-radius: 12px; border: 1px solid var(--border); text-align: center; }
        .stat-card p { font-size: 22px; font-weight: 800; color: var(--gold); margin: 5px 0 0; }

        /* üîç Search Bar */
        .search-box { width: 100%; padding: 12px; background: #000; border: 1px solid var(--border); border-radius: 8px; color: #fff; margin-bottom: 20px; }

        /* üìä Table Style */
        .table-wrap { background: var(--card); border-radius: 15px; overflow-x: auto; border: 1px solid var(--border); }
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th { background: #1a1a1a; color: var(--gold); padding: 15px; text-align: left; font-size: 13px; text-transform: uppercase; }
        td { padding: 15px; border-bottom: 1px solid #1a1a1a; font-size: 13px; vertical-align: top; }
        tr:hover { background: #151515; }

        /* üü¢ Status Tags */
        .status-select { background: #000; color: #fff; border: 1px solid #444; border-radius: 5px; padding: 5px; font-size: 11px; outline: none; }
        .st-Pending { border-color: #ff4757; color: #ff4757; }
        .st-Shipped { border-color: #3742fa; color: #3742fa; }
        .st-Delivered { border-color: #2ed573; color: #2ed573; }

        .btn { padding: 6px 12px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 11px; border: none; margin: 2px; }
        .btn-view { background: var(--gold); color: #000; }
        .btn-wa { background: #25d366; color: #fff; text-decoration: none; display: inline-block; }
        .btn-del { background: #333; color: #ff4757; }
        
        .order-item { background: #000; padding: 8px; border-radius: 5px; margin-bottom: 5px; border-left: 3px solid var(--gold); font-size: 12px; }
    </style>
</head>
<body>

<div class="admin-container">
    <div class="header-box">
        <h2 style="color:var(--gold);"><i class="fa fa-shuttle-space"></i> HAIDER MOBILES | CENTRAL</h2>
        <button class="btn btn-view" onclick="location.reload()"><i class="fa fa-sync"></i> Refresh</button>
    </div>

    <div class="stats-grid">
        <div class="stat-card"><h4><i class="fa fa-users"></i> Customers</h4><p id="totalUsers">0</p></div>
        <div class="stat-card"><h4><i class="fa fa-shopping-cart"></i> All Orders</h4><p id="totalOrders">0</p></div>
        <div class="stat-card"><h4><i class="fa fa-clock"></i> Pending</h4><p id="pendingOrders" style="color:#ff4757;">0</p></div>
    </div>

    <input type="text" id="adminSearch" class="search-box" placeholder="Search by name, phone or CNIC...">

    <div class="table-wrap">
        <table>
            <thead>
                <tr>
                    <th>Customer</th>
                    <th>Contact & CNIC</th>
                    <th>Orders & Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="adminTable"></tbody>
        </table>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCYzkMGDwWZGx_PlrNfjloYZ6PVQRne9wg",
        authDomain: "web-app-4f3a1.firebaseapp.com",
        projectId: "web-app-4f3a1",
        databaseURL: "https://web-app-4f3a1-default-rtdb.firebaseio.com",
        appId: "1:222099203820:web:778e204d2960181dfba7c9"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // üîÑ Real-time Load
    onValue(ref(db, 'users'), (snapshot) => {
        const adminTable = document.getElementById('adminTable');
        adminTable.innerHTML = "";
        let uCount = 0, oCount = 0, pCount = 0;

        snapshot.forEach((child) => {
            uCount++;
            const uid = child.key;
            const user = child.val();
            const orders = user.orders || {};

            let orderHtml = "";
            Object.keys(orders).forEach(oid => {
                oCount++;
                const order = orders[oid];
                if(order.status === "Pending") pCount++;
                
                orderHtml += `
                    <div class="order-item">
                        <b>${order.items || 'No Items'}</b><br>
                        <small style="color:#666">${order.date || ''}</small><br>
                        <select class="status-select st-${order.status}" onchange="window.updateStatus('${uid}', '${oid}', this)">
                            <option value="Pending" ${order.status==='Pending'?'selected':''}>Pending</option>
                            <option value="Shipped" ${order.status==='Shipped'?'selected':''}>Shipped</option>
                            <option value="Delivered" ${order.status==='Delivered'?'selected':''}>Delivered</option>
                        </select>
                    </div>`;
            });

            adminTable.innerHTML += `
                <tr class="user-row">
                    <td>
                        <b>${user.name || 'Unknown'}</b><br>
                        <small style="color:#888">${user.email || ''}</small>
                    </td>
                    <td>
                        <a href="tel:${user.phone}" style="color:inherit; text-decoration:none;">${user.phone || 'N/A'}</a><br>
                        <small style="color:#555">CNIC: ${user.cnic || 'N/A'}</small>
                    </td>
                    <td>${orderHtml || '<span style="color:#333">No Orders</span>'}</td>
                    <td>
                        <button class="btn btn-view" onclick="alert('Full Address: ${user.address}')"><i class="fa fa-map-marker-alt"></i></button>
                        <a href="https://wa.me/${user.phone}" class="btn btn-wa" target="_blank"><i class="fab fa-whatsapp"></i></a>
                        <button class="btn btn-del" onclick="window.deleteUser('${uid}')"><i class="fa fa-trash"></i></button>
                    </td>
                </tr>`;
        });

        document.getElementById('totalUsers').innerText = uCount;
        document.getElementById('totalOrders').innerText = oCount;
        document.getElementById('pendingOrders').innerText = pCount;
    });

    // ‚öôÔ∏è Status Update
    window.updateStatus = (uid, oid, elem) => {
        const newStatus = elem.value;
        update(ref(db, `users/${uid}/orders/${oid}`), { status: newStatus })
        .then(() => alert("Status Updated Sir!"));
    };

    // üóëÔ∏è Delete User
    window.deleteUser = (uid) => {
        if(confirm("Warning: This will remove user and all their orders. Proceed?")) {
            remove(ref(db, `users/${uid}`));
        }
    };

    // üîç Search Logic
    document.getElementById('adminSearch').oninput = (e) => {
        const val = e.target.value.toLowerCase();
        document.querySelectorAll('.user-row').forEach(row => {
            row.style.display = row.innerText.toLowerCase().includes(val) ? '' : 'none';
        });
    };
</script>
</body>
</html>
